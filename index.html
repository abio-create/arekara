<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="あれから、どのくらい？ — 活動の周期を記録・可視化するシンプルなWebアプリ。" />
  <title>アレカラ | Arekara</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#6a9e82" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="アレカラ" />
  <link rel="apple-touch-icon" href="icon.svg" />
  <link rel="icon" href="icon.svg" type="image/svg+xml" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=M+PLUS+Rounded+1c:wght@700;800&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
</head>

<body>
  <div id="app">
    <!-- List Screen -->
    <div id="screen-list" class="screen active">
      <header class="app-header">
        <h1 class="brand-title">
          <svg class="brand-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10" opacity="0.3" />
            <circle cx="12" cy="12" r="10" stroke-dasharray="20 43" stroke-dashoffset="-8" />
            <line x1="12" y1="12" x2="12" y2="7" />
            <line x1="12" y1="12" x2="16" y2="14" />
          </svg>
          アレカラ
        </h1>
        <p class="subtitle">あれから、どのくらい？</p>
      </header>

      <div id="item-list" class="item-list">
        <!-- Items rendered by JS -->
      </div>

      <div id="empty-state" class="empty-state hidden">
        <div class="empty-icon">🗂️</div>
        <p class="empty-title">まだ項目がありません</p>
        <p class="empty-desc">下のボタンから最初の項目を追加しましょう</p>
      </div>

      <button id="btn-add-item" class="fab" aria-label="新規追加">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
          stroke-linecap="round">
          <line x1="12" y1="5" x2="12" y2="19" />
          <line x1="5" y1="12" x2="19" y2="12" />
        </svg>
      </button>
    </div>

    <!-- Detail Screen -->
    <div id="screen-detail" class="screen">
      <header class="detail-header">
        <button id="btn-back" class="btn-back" aria-label="戻る">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6" />
          </svg>
        </button>
        <h2 id="detail-title" class="detail-title-text">—</h2>
        <button id="btn-delete-item" class="btn-delete" aria-label="削除">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6" />
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
            <line x1="10" y1="11" x2="10" y2="17" />
            <line x1="14" y1="11" x2="14" y2="17" />
          </svg>
        </button>
      </header>

      <!-- Record Button -->
      <button id="btn-record-detail" class="btn-record-large">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
          stroke-linecap="round">
          <line x1="12" y1="5" x2="12" y2="19" />
          <line x1="5" y1="12" x2="19" y2="12" />
        </svg>
        記録する
      </button>

      <!-- Frequency Interval Cards -->
      <div class="summary-cards summary-cards-3">
        <div class="summary-card accent-mint">
          <span class="summary-label">日ペース</span>
          <span id="freq-daily" class="summary-value">—</span>
        </div>
        <div class="summary-card accent-lavender">
          <span class="summary-label">月ペース</span>
          <span id="freq-monthly" class="summary-value">—</span>
        </div>
        <div class="summary-card accent-peach">
          <span class="summary-label">年ペース</span>
          <span id="freq-yearly" class="summary-value">—</span>
        </div>
      </div>

      <!-- Elapsed Timer -->
      <div id="elapsed-timer" class="elapsed-timer hidden">
        <div class="elapsed-timer-label">⏱ あれからの経過</div>
        <div id="elapsed-timer-value" class="elapsed-timer-value">—</div>
      </div>

      <!-- Money Dashboard -->
      <div class="money-dashboard-header">
        <div id="money-dashboard" class="section-title" style="margin-top:0;margin-bottom:0">💰 マネー・ダッシュボード</div>
        <div id="detail-price-line" class="detail-price-line" style="margin:0">
          <span id="detail-price-text" class="detail-price-text">@¥0</span>
          <button id="btn-edit-price" class="btn-edit-price" aria-label="単価を編集">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
            </svg>
          </button>
        </div>
      </div>
      <div class="summary-cards" style="margin-bottom:16px">
        <div class="summary-card accent-sky">
          <span class="summary-label">累計消費額</span>
          <span id="detail-total-cost" class="summary-value money-value">¥0</span>
        </div>
        <div id="annual-cost-card" class="summary-card accent-rose">
          <span class="summary-label">年換算コスト</span>
          <span id="detail-annual-cost" class="summary-value money-value">¥0</span>
          <span class="summary-sub">/年（予測）</span>
        </div>
      </div>

      <!-- Share Button -->
      <button id="btn-share" class="btn-share-large">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="18" cy="5" r="3" />
          <circle cx="6" cy="12" r="3" />
          <circle cx="18" cy="19" r="3" />
          <line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
          <line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
        </svg>
        シェアする
      </button>

      <!-- Period Counts -->
      <div class="section-title">期間別集計</div>
      <div class="period-grid">
        <div class="period-card">
          <span class="period-label">今日</span>
          <span id="count-today" class="period-value">0</span>
        </div>
        <div class="period-card">
          <span class="period-label">今月</span>
          <span id="count-month" class="period-value">0</span>
        </div>
        <div class="period-card">
          <span class="period-label">今年</span>
          <span id="count-year" class="period-value">0</span>
        </div>
        <div class="period-card">
          <span class="period-label">全期間</span>
          <span id="count-all" class="period-value">0</span>
        </div>
      </div>

      <!-- History -->
      <div class="section-title">履歴</div>
      <div id="history-list" class="history-list">
        <!-- Rendered by JS -->
      </div>
      <div id="history-empty" class="history-empty hidden">
        <p>まだ記録がありません</p>
      </div>
    </div>
  </div>

  <!-- Add Item Modal -->
  <div id="modal-overlay" class="modal-overlay hidden">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <h3 id="modal-title">新しい項目を追加</h3>
      <input id="input-item-name" type="text" placeholder="例：散髪、洗車、ラーメン…" maxlength="30" autocomplete="off" />
      <div class="modal-field">
        <label for="input-item-price" class="modal-label">1回あたりの金額（任意）</label>
        <div class="input-yen-wrap">
          <span class="yen-prefix">¥</span>
          <input id="input-item-price" type="number" placeholder="0" min="0" step="1" autocomplete="off" />
        </div>
      </div>
      <div class="modal-actions">
        <button id="btn-modal-cancel" class="btn-secondary">キャンセル</button>
        <button id="btn-modal-add" class="btn-primary">追加</button>
      </div>
    </div>
  </div>

  <!-- Record with Amount Modal -->
  <div id="modal-record-overlay" class="modal-overlay hidden">
    <div class="modal" role="dialog" aria-modal="true">
      <h3>📝 金額を確認</h3>
      <p class="modal-record-desc">金額を変更できます（今回だけ特別な場合など）</p>
      <div class="input-yen-wrap">
        <span class="yen-prefix">¥</span>
        <input id="input-record-amount" type="number" placeholder="0" min="0" step="1" autocomplete="off" />
      </div>
      <div class="modal-actions">
        <button id="btn-record-cancel" class="btn-secondary">キャンセル</button>
        <button id="btn-record-confirm" class="btn-primary">記録する</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirm Modal -->
  <div id="modal-delete-overlay" class="modal-overlay hidden">
    <div class="modal" role="dialog" aria-modal="true">
      <h3>この項目を削除しますか？</h3>
      <p class="modal-delete-desc">すべての記録も削除されます。この操作は元に戻せません。</p>
      <div class="modal-actions">
        <button id="btn-delete-cancel" class="btn-secondary">キャンセル</button>
        <button id="btn-delete-confirm" class="btn-danger">削除</button>
      </div>
    </div>
  </div>

  <!-- Price Edit Modal (small) -->
  <div id="modal-price-edit-overlay" class="modal-overlay hidden">
    <div class="modal modal-compact" role="dialog" aria-modal="true">
      <h3>⇒ 単価を変更</h3>
      <p class="modal-desc-subtle">今後の記録に適用されます。過去のデータは変更されません。</p>
      <div class="input-yen-wrap input-yen-wrap-sm">
        <span class="yen-prefix">¥</span>
        <input id="input-edit-price" type="number" placeholder="0" min="0" step="1" autocomplete="off" />
      </div>
      <div class="modal-actions">
        <button id="btn-price-edit-cancel" class="btn-secondary">キャンセル</button>
        <button id="btn-price-edit-save" class="btn-primary">保存</button>
      </div>
    </div>
  </div>

  <!-- History Record Edit Modal -->
  <div id="modal-history-edit-overlay" class="modal-overlay hidden">
    <div class="modal modal-compact" role="dialog" aria-modal="true">
      <h3>📝 記録を編集</h3>
      <p id="history-edit-date" class="modal-desc-subtle"></p>
      <div class="modal-field">
        <label class="modal-label">金額</label>
        <div class="input-yen-wrap input-yen-wrap-sm">
          <span class="yen-prefix">¥</span>
          <input id="input-history-amount" type="number" placeholder="0" min="0" step="1" autocomplete="off" />
        </div>
      </div>
      <div class="modal-actions">
        <button id="btn-history-edit-cancel" class="btn-secondary">キャンセル</button>
        <button id="btn-history-edit-save" class="btn-primary">保存</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast hidden">記録しました！</div>

  <!-- Share Card Template (hidden, rendered by html2canvas) -->
  <div id="share-card" class="share-card">
    <div class="share-card-bg" id="share-card-bg"></div>
    <div class="share-card-content">
      <!-- Stability stamp (top-right) -->
      <div class="share-card-stamp" id="share-card-stamp"></div>
      <!-- Header -->
      <div class="share-card-header">
        <div class="share-card-app">アレカラ報告</div>
        <div class="share-card-subtitle" id="share-card-name"></div>
      </div>
      <!-- Main: Average Interval -->
      <div class="share-card-main">
        <div class="share-card-avg-label">平均アレカラ周期</div>
        <div class="share-card-avg-num" id="share-card-avg">—</div>
      </div>
      <!-- Sub: Comparison to average -->
      <div class="share-card-compare" id="share-card-compare"></div>
      <!-- Rhythm bar chart -->
      <div class="share-card-rhythm">
        <div class="share-card-rhythm-label">直近のリズム</div>
        <div class="share-card-bars" id="share-card-bars"></div>
      </div>
      <!-- Footer -->
      <div class="share-card-footer">
        <div class="share-card-qr">
          <img id="share-card-qr-img" src="" alt="QR" width="56" height="56" />
        </div>
        <div class="share-card-url">Arekara</div>
      </div>
    </div>
  </div>

  <!-- Share Preview Modal -->
  <div id="modal-share-overlay" class="modal-overlay hidden">
    <div class="modal modal-share" role="dialog" aria-modal="true">
      <h3>🖼️ シェアプレビュー</h3>
      <div id="share-preview" class="share-preview"></div>
      <div class="share-actions">
        <button id="btn-share-save" class="btn-share-action btn-share-save">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <polyline points="7 10 12 15 17 10" />
            <line x1="12" y1="15" x2="12" y2="3" />
          </svg>
          画像を保存
        </button>
        <button id="btn-share-x" class="btn-share-action btn-share-x">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
          </svg>
          Xで共有
        </button>
      </div>
      <button id="btn-share-close" class="btn-secondary" style="margin-top:12px;width:100%">閉じる</button>
    </div>
  </div>

  <script src="app.js"></script>
</body>

</html>